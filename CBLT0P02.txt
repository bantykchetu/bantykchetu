       ID DIVISION.
       PROGRAM-ID. CBLT0P02.
       AUTHOR. NAME.
       DATE-WRITTEN. TODAY.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRAN-INFILE  ASSIGN TO TRANDD01
           ORGANIZATION IS SEQUENTIAL
           ACCESS MODE IS SEQUENTIAL
           FILE STATUS IS WS-IN-STATUS.

           SELECT TRAN-OTFILE  ASSIGN TO TRANDD02
           ORGANIZATION IS SEQUENTIAL
           ACCESS MODE IS SEQUENTIAL
           FILE STATUS IS WS-OT-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD TRAN-INFILE
           LABEL RECORD ARE STANDARD.
       01 TRAN-REC-IN.
          03 CARD-NUMBER  PIC  X(05).
          03 TRANS-DATE   PIC  X(10).
          03 TRANS-AMT    PIC  S9(05)V9(02).

       FD TRAN-OTFILE
           LABEL RECORD ARE STANDARD.
       01 TRAN-REC-OT.
          03 CARD-NUMBER  PIC  X(05).
          03 TOTAL-DUE-AMT PIC  S9(05)V9(02).

       WORKING-STORAGE SECTION.
       01 WS-IN-STATUS    PIC  X(02) VALUE SPACE.
       01 WS-OT-STATUS    PIC  X(02) VALUE SPACE.
       01 WS-IN-REC-CNT   PIC  9(02) VALUE ZERO.
       01 WS-OT-REC-CNT   PIC  9(02) VALUE ZERO.

       01 WS-END-OF-FILE  PIC  X(01) VALUE SPACE.
       01 WS-ABENDPGM     PIC  X(08) VALUE 'ABENDPGM'.
       01 WS-CARD-NUMBER-HOLD PIC X(05) VALUE SPACE.
       01 WS-TOTAL-DUE PIC      S9(5)V9(2) VALUE ZERO.
       PROCEDURE DIVISION.
       000-MAIN-PARA.
           DISPLAY 'CBLT0P02 STARTED'.

           PERFORM 100-INITIAL-PARA THRU 100-EXIT
           PERFORM 200-GET-INPUT-PARA THRU 200-EXIT
           PERFORM 300-PROCESS-PARA   THRU 300-EXIT
                          UNTIL WS-END-OF-FILE = 'Y'.

           CLOSE TRAN-INFILE TRAN-OTFILE.
           DISPLAY 'TOTAL INPUT REC COUNT ' WS-IN-REC-CNT.
           DISPLAY 'TOTAL OTPUT REC COUNT ' WS-OT-REC-CNT.
           STOP RUN.

       100-INITIAL-PARA.
           MOVE 'N' TO WS-END-OF-FILE.
           MOVE ZERO TO  WS-IN-REC-CNT WS-OT-REC-CNT
                         WS-TOTAL-DUE.
           OPEN INPUT TRAN-INFILE
           OPEN OUTPUT TRAN-OTFILE.
           IF WS-IN-STATUS NOT = '00'  OR
               WS-OT-STATUS NOT = '00'
                  DISPLAY 'ERROR IN 100-PARA'
                  DISPLAY 'INPUT FILE STATUS ' WS-IN-STATUS
                  DISPLAY 'OTPUT FILE STATUS ' WS-OT-STATUS
                  CALL WS-ABENDPGM
           END-IF.
           PERFORM 110-GET-FIRST-REC-PARA THRU 110-EXIT.
       100-EXIT. EXIT.

       110-GET-FIRST-REC-PARA.
           READ TRAN-INFILE
              AT END
                MOVE 'Y' TO WS-END-OF-FILE
                GO TO 110-EXIT.

           ADD +1 TO WS-IN-REC-CNT.
           MOVE  CARD-NUMBER OF TRAN-REC-IN TO WS-CARD-NUMBER-HOLD.
           COMPUTE WS-TOTAL-DUE = WS-TOTAL-DUE + TRANS-AMT.

       110-EXIT. EXIT.

       200-GET-INPUT-PARA.
           READ TRAN-INFILE
              AT END
                 MOVE 'Y' TO WS-END-OF-FILE
                 GO TO 200-EXIT.

           ADD +1 TO WS-IN-REC-CNT.
       200-EXIT. EXIT.

       300-PROCESS-PARA.
           IF CARD-NUMBER OF TRAN-REC-IN = WS-CARD-NUMBER-HOLD
               COMPUTE WS-TOTAL-DUE = WS-TOTAL-DUE + TRANS-AMT
           ELSE
               PERFORM 350-MOVE-WRITE-PARA THRU 350-EXIT
               MOVE ZERO TO WS-TOTAL-DUE
               MOVE CARD-NUMBER OF TRAN-REC-IN TO WS-CARD-NUMBER-HOLD
               COMPUTE WS-TOTAL-DUE = WS-TOTAL-DUE + TRANS-AMT
           END-IF.

           PERFORM 200-GET-INPUT-PARA THRU 200-EXIT.

       300-EXIT. EXIT.

       350-MOVE-WRITE-PARA.
           MOVE WS-CARD-NUMBER-HOLD        TO
                     CARD-NUMBER OF TRAN-REC-OT
           MOVE WS-TOTAL-DUE TO TOTAL-DUE-AMT OF TRAN-REC-OT.

           WRITE TRAN-REC-OT.
           IF WS-OT-STATUS NOT = '00'
               DISPLAY  'ERROR IN 350-PARA'
               DISPLAY 'OT STATUS IS ' WS-OT-STATUS
               DISPLAY 'RECORD IS  ' TRAN-REC-IN
               CALL WS-ABENDPGM
           END-IF.
           ADD +1 TO WS-OT-REC-CNT.
       350-EXIT. EXIT.

